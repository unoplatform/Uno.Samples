parameters:
- name: solution
  type: string
  default: ''

steps:
- pwsh: |
    git merge origin/master -s recursive -X theirs
    $savedMSBuildExtensionsPath = $env:MSBuildExtensionsPath
    $env:MSBuildExtensionsPath = 'C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild'
    $folderPath = [System.IO.Path]::GetDirectoryName("${{ parameters.solution }}");
    dotnet new sln --name=Uno.Samples.generated
    dotnet sln Uno.Samples.generated.sln add (Get-ChildItem -Path $folderPath -Recurse *.csproj)
    $env:MSBuildExtensionsPath = $savedMSBuildExtensionsPath

- task: nventiveCanaryUpdater@5
  displayName: 'Canary Update'
  condition: startsWith(variables['Build.SourceBranch'], 'refs/heads/canaries')
  inputs:
    solution: $(build.sourcesdirectory)
    usePrivateFeed: false
    useNuGetOrg: true
    mergeBranch: true
    branchToMerge: master
    nugetUpdaterVersion: '2.3.0-alpha.65'
    nugetVersion: dev
    packageAuthor: 'nventive,unoplatform,uno platform'
    summaryFile: '$(Build.ArtifactStagingDirectory)/Summary.md'
    resultFile: '$(Build.ArtifactStagingDirectory)/Results.json'
    additionalPublicSources: 'https://pkgs.dev.azure.com/uno-platform/1dd81cbd-cb35-41de-a570-b0df3571a196/_packaging/unoplatformdev/nuget/v3/index.json'

- pwsh: |
    del Uno.Samples.generated.sln
